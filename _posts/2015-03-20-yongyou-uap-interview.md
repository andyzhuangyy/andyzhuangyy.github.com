---
layout: post
title: "用友 UAP 面试"
description: ""
category: "面试"
tags: [网络编程, 面试]
---
{% include JB/setup %}

用友 UAP 的一个 C++ 或 JAVA 职位，刚刚投的简历，没做好充分的准备，以后面试之前一定要做好准备，很多之前在书上看到的知识点，都无法连贯的回答上来，于是面试效果很不理想。

## 1. 心理感受
很久没面试，并且在保密单位呆得太久，人渐渐变木，外加最近在 100offer 上简历总是挂掉的原因，心里层面可能有一些恐惧，觉得自己很多地方不如现在的互联网的从业人员。所以伴随着这样的不自信，全场发挥的不理想。


## 2. 技术问题
### 服务端编程模型
* 单机可同时建立的 tcp 连接数。

    好吧这个问题的确没有回答对。起初思路仅仅放在单机可以建立的监听端口数量，显然这个思路是不对的。
    tcp 连接是靠四元组{local ip, local port,remote ip,remote port}标识的。即使端口相同也未必是同一个连接。

    对于 client 来说，除非绑定端口，通常会让系统选取一个空闲的本地端口（local port） 该端口为独占，不能和其它tcp连接共享，并且小于1024的端口为保留端口，所以对于 client 来说可以连接大概最多64000多个不同的服务端。

    对于 server 端来说，server通常固定在某个本地端口上监听，等待client的连接请求。不考虑地址重用的情况下，即使server端有多个ip，本地监听端口也是独占的。因为server端tcp连接的4元组只有 remote ip（即client ip）和remote port（客户端端口）可变的，因此，最大的tcp连接数为客户端ip数*客户端port数，对于ipv4，不考虑地址分类等因素，最大的tcp连接数约为2的32次方（ipv4数量）乘以2的16次方（port数量），也就是server端单机的最大tcp连接数约为2的48次方。

    实际环境中的tcp连接数量，受到机器资源、操作系统等限制，特别是server端，最大并发tcp连接数远不能达到理论上限。在linux平台下，tcp连接数的主要因素是内存限制和允许的文件描述符fd的个数（因为每个tcp连接都要占用一定内存，每个socket就是一个文件描述符fd，而linux系统对用户的单一进程同时打开的文件数量是有限制的）。

    对server端，通过增加内存、修改最大文件描述符个数等参数，单机最大并发TCP连接数超过10万 是没问题的，国外 Urban Airship 公司在产品环境中已做到 50 万并发 。在实际应用中，对大规模网络应用，还需要考虑C10K 问题。

* I/O 端口复用的问题
    其实就是 IO 多路复用的问题，只是上一个问题没有理解，于是这个问题当时很难回答。IO 多路复用就是类似 select/poll 等，同时监听多路的 IO 事件。

* 如何单机实现 C10k

    也是第一个问题没有理解。

* 服务端并发模型，无阻塞实现原理

    没有理解问题问的是「有关于并发无阻塞模型都有那些」，其实面试官想要的答案是 Reactor/Proactor，并且说出其中的区别和实现细节。

    然而我回答实现无阻塞使用 poll 或 epoll，但是我没有回答出「事件驱动」、「事件循环」、「事件回调」。

    陈硕的书里写的，Reactor 就是『无阻塞 IO + IO 多路复用』，也就是 Java 中的 NIO 方式。
    libev 里作者说，「一个线程一个循环常常是一个好模型」。

    Event loop 代表了线程的主循环，需要让那个线程干活，就把 timer 或 IO channel 注册到哪个线程的 loop 里。

    而 Proactor 是做完一件事，用回调函数，让系统把任务串起来。Proactor 模式依赖操作系统或库来高效地调度这些子任务，每个子任务都不会阻塞，因此能用比较少的线程达到很高的 IO 并发度。



* epoll/poll 相关有哪些系统调用

    由于上一题仅答出了poll 和 epoll，于是被问到，都涉及哪些系统调用。

    和 epoll 相关的，epoll_create/epoll_ctl/epoll_wait/


* 平时编程是用 posix 接口多一些还是 system 5多一些？

    平时不太区分。

### 网络编程
* 毡包的处理，协议的处理

    这个由于项目中对这个的处理还是比较合适的，所以回答还凑合。

* syn/ack相关
    (待完善？)

* 底层并发量巨大，包无法收全，缓存占用过多的问题
    (待完善？)


### 数据库
* 事务相关

* 事务提交，嵌套提交

    每一个COMMIT TRAN语句总是应用于最后一个执行的BEGIN TRAN。

    而ROLLBACK 要么就所有事务都回滚，要么就回滚时异常，一个事务都没回滚！

    内部事务提交，外部的事务不会提交。

* 事务隔离级别

    未提交读(Read Uncommitted)：允许脏读，也就是可能读取到其他会话中未提交事务修改的数据

    提交读(Read Committed)：只能读取到已经提交的数据。Oracle等多数数据库默认都是该级别 (不重复读)

    可重复读(Repeated Read)：可重复读。在同一个事务内的查询都是事务开始时刻一致的，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻象读

    串行读(Serializable)：完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞


### 其他
* 都看过那些源码
    我回答说看过 python 的源码，被问是编译器还是解释器，我很令人无语的说是从入口开始看的。其实应该直接回答是解释器。


## 3. 对方的看法
对方还是觉得我比较有学习的动力和积极性，还是很想学习新技术的，所以勉强给了和应届生一样工资的 offer。


## 4. 总结

1. 面试之前要知道自己想要什么，想要做什么，自己以后想要学什么，玩什么。
2. 即使是在非互联网公司工作，也不要把自己看低。那些在互联网公司工作的人也无非用了一些比较新的东西而已，就技术含量和深度来说，未必有自己的高深。不能自卑，认真、耐心的讲好自己项目的重点、难点、改进的地方、技术含量。
3. 不能自己看轻自己，要觉得自己很有价值，对别人很有价值，在新环境中会成长很快，看得清自己的优点，敢于和面试官对峙，敢于要出自己的价钱。
4. 面试的问题，很多是发散思维，没有具体的答案，说错了不要紧，要敢于发挥想象，说出自己的想法。
